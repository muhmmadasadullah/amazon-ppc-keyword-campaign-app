<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amazon PPC Keyword Research & Campaign Builder V2.4</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <style>
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .upload-zone {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            transition: all 0.3s ease;
            padding: 2rem;
        }
        .upload-zone.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .filter-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        .keyword-row {
            transition: all 0.2s ease;
        }
        .keyword-row:hover {
            background-color: #f8fafc;
        }
        .keyword-row.selected {
            background-color: #eff6ff;
            border-left: 4px solid #3b82f6;
        }
        .campaign-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            backdrop-filter: blur(10px);
        }
        .campaign-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .campaign-card.selected {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        .isolation-section {
            display: none;
            animation: slideInUp 0.4s ease-out;
        }
        .isolation-section.show {
            display: block;
        }
        @keyframes slideInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        .btn-add {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .btn-add::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        .btn-add:hover::before {
            left: 100%;
        }
        .btn-add:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .btn-sp-ex { 
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .btn-sp-ex:hover { 
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        .btn-sp-ph { 
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.3);
        }
        .btn-sp-ph:hover { 
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.4);
        }
        .btn-sp-br { 
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            box-shadow: 0 4px 15px rgba(22, 163, 74, 0.3);
        }
        .btn-sp-br:hover { 
            background: linear-gradient(135deg, #15803d 0%, #166534 100%);
            box-shadow: 0 8px 25px rgba(22, 163, 74, 0.4);
        }
        .btn-sp-bmm { 
            background: linear-gradient(135deg, #14b8a6 0%, #0f766e 100%);
            box-shadow: 0 4px 15px rgba(20, 184, 166, 0.3);
        }
        .btn-sp-bmm:hover { 
            background: linear-gradient(135deg, #0f766e 0%, #0d9488 100%);
            box-shadow: 0 8px 25px rgba(20, 184, 166, 0.4);
        }
        .btn-sp-pat { 
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        .btn-sp-pat:hover { 
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }
        .btn-skc-ex { 
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }
        .btn-skc-ex:hover { 
            background: linear-gradient(135deg, #4338ca 0%, #3730a3 100%);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
        }
        .btn-auto-ca { 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        .btn-auto-ca:hover { 
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        .btn-auto-cm { 
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        .btn-auto-cm:hover { 
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
        .btn-auto-sb { 
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            box-shadow: 0 4px 15px rgba(244, 63, 94, 0.3);
        }
        .btn-auto-sb:hover { 
            background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);
            box-shadow: 0 8px 25px rgba(244, 63, 94, 0.4);
        }
        .btn-auto-lm { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        .btn-auto-lm:hover { 
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }
        .btn-auto-cp { 
            background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);
            box-shadow: 0 4px 15px rgba(244, 63, 94, 0.3);
        }
        .btn-auto-cp:hover { 
            background: linear-gradient(135deg, #e11d48 0%, #be123c 100%);
            box-shadow: 0 8px 25px rgba(244, 63, 94, 0.4);
        }
        .live-preview-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            color: white;
            position: relative;
            overflow: hidden;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .live-preview-content {
            position: relative;
            z-index: 1;
        }
        .preview-campaign-name {
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 16px;
            font-weight: 600;
            line-height: 1.4;
            background: rgba(255, 255, 255, 0.15);
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            word-break: break-all;
        }
        .preview-empty-state {
            text-align: center;
            opacity: 0.8;
            font-style: italic;
        }
        .preview-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            opacity: 0.9;
            display: flex;
            align-items: center;
        }
        .campaign-count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            border: 2px solid white;
        }
        .campaign-instance-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            padding: 8px 12px;
            border-radius: 8px;
            margin-top: 6px;
            border: 1px solid #93c5fd;
        }
        .campaign-instance-item .version-label {
            font-size: 12px;
            font-weight: 600;
            color: #1e40af;
        }
        .campaign-instance-item .remove-btn {
            color: #dc2626;
            font-size: 12px;
            cursor: pointer;
            padding: 4px 6px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .campaign-instance-item .remove-btn:hover {
            background: #fecaca;
            color: #991b1b;
        }
        .form-input {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            font-size: 16px;
        }
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }
        .section-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.15);
        }
        .header-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #6B73FF 100%);
            position: relative;
            overflow: hidden;
        }
        .overview-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .overview-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #3b82f6;
            line-height: 1;
            margin-bottom: 8px;
        }
        .overview-label {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
        }
        .bulk-actions-toolbar {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            justify-content: space-between;
        }
        .bulk-actions-toolbar.show {
            display: flex;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <div class="header-gradient text-white py-8 relative">
        <div class="container mx-auto px-4 text-center relative z-10">
            <h1 class="text-4xl font-bold flex items-center justify-center mb-2">
                <i class="fas fa-search mr-4 text-5xl"></i>
                Amazon PPC Keyword Research & Campaign Builder
            </h1>
            <div class="flex items-center justify-center space-x-3 mb-2">
                <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full text-sm font-semibold">V2.4</span>
                <span class="text-purple-200">Research keywords & generate Amazon-ready campaigns</span>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <div class="flex space-x-4 mb-8">
            <button class="tab-button active px-6 py-3 font-medium text-gray-700 hover:text-blue-600" onclick="switchMainTab('keyword-research')">
                <i class="fas fa-search mr-2"></i>Keyword Research
            </button>
            <button class="tab-button px-6 py-3 font-medium text-gray-700 hover:text-blue-600" onclick="switchMainTab('campaign-builder')">
                <i class="fas fa-chart-line mr-2"></i>Campaign Builder
            </button>
        </div>

        <div id="keyword-research" class="tab-content active">
            <div class="section-card p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-upload text-blue-600 mr-3 text-3xl"></i>
                    Upload Keyword Files
                </h2>
                
                <div class="upload-zone text-center" id="uploadZone">
                    <div class="mb-4">
                        <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700 mb-2">Drop keyword files here or click to upload</h3>
                        <p class="text-gray-500 mb-4">Supports Data Dive CSV, H10 Cerebro Excel, and other formats</p>
                    </div>
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" class="hidden" multiple>
                    <button onclick="document.getElementById('fileInput').click()" class="bg-gradient-to-r from-teal-500 to-blue-600 hover:from-teal-600 hover:to-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                        <i class="fas fa-plus mr-2"></i>Choose Files
                    </button>
                    <div id="fileList" class="mt-4 text-left hidden"></div>
                </div>
            </div>

            <div id="filtersSection" class="section-card p-8 mb-8 hidden">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-filter text-purple-600 mr-3 text-3xl"></i>
                    Keyword Filters
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="filter-card">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Search Volume</label>
                        <div class="flex space-x-2">
                            <input type="number" id="svMin" placeholder="Min" class="form-input w-full text-sm py-2 px-3">
                            <input type="number" id="svMax" placeholder="Max" class="form-input w-full text-sm py-2 px-3">
                        </div>
                    </div>

                    <div class="filter-card">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ranking Competitors (Min)</label>
                        <input type="number" id="rankingCompsMin" placeholder="e.g. 3" class="form-input w-full text-sm py-2 px-3">
                    </div>

                    <div class="filter-card">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Competitor Avg Rank (Max)</label>
                        <input type="number" id="compRankMax" placeholder="e.g. 60" class="form-input w-full text-sm py-2 px-3">
                    </div>

                    <div class="filter-card">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sponsored Count (Min)</label>
                        <input type="number" id="sponsoredCountMin" placeholder="e.g. 1" class="form-input w-full text-sm py-2 px-3">
                    </div>

                    <div class="filter-card">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Title Density (Max)</label>
                        <input type="number" id="titleDensityMax" placeholder="e.g. 50" class="form-input w-full text-sm py-2 px-3">
                    </div>

                    <div class="filter-card">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Word Count</label>
                        <div class="flex space-x-2">
                            <input type="number" id="wordCountMin" placeholder="Min" class="form-input w-full text-sm py-2 px-3">
                            <input type="number" id="wordCountMax" placeholder="Max" class="form-input w-full text-sm py-2 px-3">
                        </div>
                    </div>
                </div>

                <div class="filter-card mt-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Root Keywords (Include/Exclude)</label>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <input type="text" id="includeKeywords" placeholder="Include terms (comma separated)" class="form-input w-full text-sm py-2 px-3">
                            <p class="text-xs text-gray-500 mt-1">Must contain these terms</p>
                        </div>
                        <div>
                            <input type="text" id="excludeKeywords" placeholder="Exclude terms (comma separated)" class="form-input w-full text-sm py-2 px-3">
                            <p class="text-xs text-gray-500 mt-1">Must NOT contain these terms</p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center mt-6">
                    <button onclick="applyFilters()" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-3 rounded-lg transition-colors">
                        <i class="fas fa-filter mr-2"></i>Apply Filters
                    </button>
                    <button onclick="resetFilters()" class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-undo mr-2"></i>Reset
                    </button>
                </div>
            </div>

            <div id="resultsSection" class="section-card p-8 mb-8 hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold flex items-center">
                        <i class="fas fa-table text-green-600 mr-3 text-3xl"></i>
                        Keyword Results
                        <span id="resultsCount" class="text-lg text-gray-500 ml-3"></span>
                    </h2>
                    
                    <div class="flex space-x-4">
                        <select id="sortBy" class="form-input py-2 px-3 text-sm" onchange="sortResults()">
                            <option value="searchVolume_desc">Search Volume (High to Low)</option>
                            <option value="searchVolume_asc">Search Volume (Low to High)</option>
                            <option value="rankingCompetitors_desc">Ranking Competitors (High to Low)</option>
                            <option value="rankingCompetitors_asc">Ranking Competitors (Low to High)</option>
                            <option value="competitorRank_asc">Competitor Rank (Low to High)</option>
                            <option value="titleDensity_asc">Title Density (Low to High)</option>
                            <option value="sponsoredCount_desc">Sponsored Count (High to Low)</option>
                        </select>
                        
                        <button onclick="exportResults()" class="bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white px-4 py-2 rounded-lg transition-colors">
                            <i class="fas fa-download mr-2"></i>Export CSV
                        </button>
                    </div>
                </div>

                <div class="bulk-actions-toolbar" id="bulkToolbar">
                    <div class="flex items-center space-x-4">
                        <span id="selectedCount">0 selected</span>
                        <select id="bulkMatchType" class="bg-white bg-opacity-20 text-gray-900 rounded px-3 py-1 text-sm border border-white/30">
                            <!-- Updated by agent: ensure options are visible (use dark text) -->
                            <option value="exact">Exact Match</option>
                            <option value="broad">Broad Match</option>
                            <option value="phrase">Phrase Match</option>
                        </select>
                        <!-- Added by agent: toggle to control add vs move behavior -->
                        <label class="inline-flex items-center text-white/90 text-sm">
                            <input id="bulkAddMode" type="checkbox" class="mr-2">
                            Add (don’t remove)
                        </label>
                        <button onclick="applyBulkMatchType()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-1 rounded text-sm transition-colors">
                            Apply to Selected
                        </button>
                    </div>
                    <button onclick="clearSelection()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-1 rounded text-sm transition-colors">
                        Clear Selection
                    </button>
                </div>

                <div id="savedKeywordsSection" class="mb-6 hidden">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h3 class="font-semibold text-blue-800 mb-2 flex items-center justify-between">
                                <span><i class="fas fa-bullseye mr-2"></i>Exact Match</span>
                                <span id="exactCount" class="text-sm bg-blue-200 px-2 py-1 rounded-full">0</span>
                            </h3>
                            <div id="exactKeywords" class="space-y-1 max-h-32 overflow-y-auto"></div>
                            <button onclick="copyKeywords('exact')" class="mt-2 text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-3 py-1 rounded hover:from-blue-700 hover:to-blue-800 transition-colors">
                                Copy All
                            </button>
                            <button onclick="clearKeywords('exact')" class="mt-2 ml-2 text-xs bg-white text-blue-700 border border-blue-300 px-3 py-1 rounded hover:bg-blue-50">
                                Remove All
                            </button>
                        </div>

                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h3 class="font-semibold text-green-800 mb-2 flex items-center justify-between">
                                <span><i class="fas fa-expand-arrows-alt mr-2"></i>Broad Match</span>
                                <span id="broadCount" class="text-sm bg-green-200 px-2 py-1 rounded-full">0</span>
                            </h3>
                            <div id="broadKeywords" class="space-y-1 max-h-32 overflow-y-auto"></div>
                            <button onclick="copyKeywords('broad')" class="mt-2 text-xs bg-gradient-to-r from-green-600 to-green-700 text-white px-3 py-1 rounded hover:from-green-700 hover:to-green-800 transition-colors">
                                Copy All
                            </button>
                            <button onclick="clearKeywords('broad')" class="mt-2 ml-2 text-xs bg-white text-green-700 border border-green-300 px-3 py-1 rounded hover:bg-green-50">
                                Remove All
                            </button>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <h3 class="font-semibold text-purple-800 mb-2 flex items-center justify-between">
                                <span><i class="fas fa-quote-left mr-2"></i>Phrase Match</span>
                                <span id="phraseCount" class="text-sm bg-purple-200 px-2 py-1 rounded-full">0</span>
                            </h3>
                            <div id="phraseKeywords" class="space-y-1 max-h-32 overflow-y-auto"></div>
                            <button onclick="copyKeywords('phrase')" class="mt-2 text-xs bg-gradient-to-r from-purple-600 to-purple-700 text-white px-3 py-1 rounded hover:from-purple-700 hover:to-purple-800 transition-colors">
                                Copy All
                            </button>
                            <button onclick="clearKeywords('phrase')" class="mt-2 ml-2 text-xs bg-white text-purple-700 border border-purple-300 px-3 py-1 rounded hover:bg-purple-50">
                                Remove All
                            </button>
                        </div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-50 border-b">
                                <th class="text-left p-3 font-medium text-gray-700">
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" class="mr-2">
                                    Select
                                </th>
                                <th class="text-left p-3 font-medium text-gray-700">Keyword</th>
                                <th class="text-left p-3 font-medium text-gray-700">Search Volume</th>
                                <th class="text-left p-3 font-medium text-gray-700">Word Count</th>
                                <th class="text-left p-3 font-medium text-gray-700">Comp. Rank</th>
                                <th class="text-left p-3 font-medium text-gray-700">Ranking Comps</th>
                                <th class="text-left p-3 font-medium text-gray-700">Sponsored Count</th>
                                <th class="text-left p-3 font-medium text-gray-700">Title Density</th>
                                <th class="text-left p-3 font-medium text-gray-700">Match Type</th>
                            </tr>
                        </thead>
                        <tbody id="resultsTable">
                        </tbody>
                    </table>
                </div>

                <div id="noResults" class="text-center py-12 text-gray-500 hidden">
                    <i class="fas fa-search text-5xl mb-4"></i>
                    <p class="text-lg">No keywords match your current filters.</p>
                    <p class="text-sm">Try adjusting your filter criteria.</p>
                </div>
            </div>
        </div>

        <div id="campaign-builder" class="tab-content">
            <div id="campaignOverview" class="section-card p-8 mb-8 hidden">
                <h2 class="text-2xl font-semibold mb-6 flex items-center text-gray-800">
                    <i class="fas fa-chart-pie text-blue-600 mr-3 text-3xl"></i>
                    Campaign Overview
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="overview-card">
                        <div id="totalCampaigns" class="overview-number">0</div>
                        <div class="overview-label">Total Campaigns</div>
                    </div>
                    <div class="overview-card">
                        <div id="totalKeywords" class="overview-number">0</div>
                        <div class="overview-label">Keywords</div>
                    </div>
                    <div class="overview-card">
                        <div id="totalTargets" class="overview-number">0</div>
                        <div class="overview-label">Product Targets</div>
                    </div>
                    <div class="overview-card">
                        <div id="totalBudget" class="overview-number">$0</div>
                        <div class="overview-label">All Campaigns Total Budget</div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-4">Product Information</h3>
                        <div id="overviewProductInfo" class="space-y-2 text-sm text-gray-600"></div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-4">Campaign Breakdown</h3>
                        <div id="overviewCampaignInfo" class="space-y-2 text-sm text-gray-600"></div>
                    </div>
                </div>
            </div>

            <div class="section-card p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-box text-blue-600 mr-3 text-3xl"></i>
                    Product Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Product Name *</label>
                        <input type="text" id="productName" placeholder="Enter your product name" 
                               class="form-input w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-2">This will be used in your campaign names</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Product ASIN *</label>
                        <input type="text" id="productASIN" placeholder="B08XYZ123ABC" 
                               class="form-input w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-2">Will be included at the end of campaign names</p>
                    </div>
                </div>
                <div class="mt-8">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Product SKUs *</label>
                    <textarea id="productSKUs" rows="4" placeholder="Enter one SKU per line&#10;SKU-001&#10;SKU-002&#10;SKU-003"
                             class="form-input w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                    <p class="text-xs text-gray-500 mt-2">Enter one SKU per line for multiple products</p>
                </div>
            </div>

            <div class="section-card p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-palette text-purple-600 mr-3 text-3xl"></i>
                    Campaign Theme
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Global Campaign Theme</label>
                        <select id="campaignTheme" class="form-input w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">No Theme</option>
                            <option value="BKWS">BKWS - Branded Keywords</option>
                            <option value="Def PDP">Def PDP - Defensive Product Detail Page</option>
                            <option value="Rank">Rank - Ranking Keywords</option>
                            <option value="Scale">Scale - Scaling Campaigns</option>
                            <option value="Research">Research - Keyword Research</option>
                            <option value="Offense">Offense - Product Targeting</option>
                            <option value="Mixed">Mixed - Multiple Campaign Types</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-2">Applies to all campaigns by default</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <input type="checkbox" id="enableCustomTheme" class="mr-2">
                            Enable Custom Global Theme
                        </label>
                        <input type="text" id="customTheme" placeholder="Enter custom theme name" disabled
                               class="form-input w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100">
                        <p class="text-xs text-gray-500 mt-2">Override with your own theme name</p>
                    </div>
                </div>
            </div>

            <div class="section-card p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-tag text-orange-600 mr-3 text-3xl"></i>
                    Campaign Nomenclature
                </h2>
                
                <div class="mb-8">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Campaign Naming Pattern</label>
                    <input type="text" id="nomenclaturePattern" 
                           value="{PRODUCT} - {THEME} - {CAMPAIGN} - {ASIN} - {PLACEMENTS}"
                           placeholder="Customize your campaign naming pattern"
                           class="form-input w-full focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    <p class="text-xs text-gray-500 mt-3">
                        Use placeholders: {PRODUCT}, {THEME}, {CAMPAIGN}, {ASIN}, {PLACEMENTS}
                    </p>
                </div>
                
                <div>
                    <div class="live-preview-card">
                        <div class="live-preview-content">
                            <div class="preview-label">
                                <i class="fas fa-eye"></i>
                                Live Preview
                            </div>
                            <div id="livePreviewContent" class="preview-campaign-name preview-empty-state">
                                Enter product details and configure a campaign to see preview
                            </div>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500 mt-3 text-center">
                        <i class="fas fa-info-circle mr-1"></i>
                        Updates automatically based on your active campaign tab
                    </p>
                </div>
            </div>

            <div class="section-card p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-list text-green-600 mr-3 text-3xl"></i>
                    Campaign Types
                </h2>
                
                <div class="mb-8">
                    <h3 class="text-xl font-medium text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-hand-paper text-blue-600 mr-2"></i>
                        Manual Campaigns
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="SP-EX">
                            <div class="campaign-count-badge hidden" id="count-SP-EX">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">SP-EX</h4>
                                <p class="text-sm text-gray-600">Exact Match</p>
                            </div>
                            <button class="btn-add btn-sp-ex w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('SP-EX')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-SP-EX"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="SP-PH">
                            <div class="campaign-count-badge hidden" id="count-SP-PH">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">SP-PH</h4>
                                <p class="text-sm text-gray-600">Phrase Match</p>
                            </div>
                            <button class="btn-add btn-sp-ph w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('SP-PH')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-SP-PH"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="SP-BR">
                            <div class="campaign-count-badge hidden" id="count-SP-BR">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">SP-BR</h4>
                                <p class="text-sm text-gray-600">Broad Match</p>
                            </div>
                            <button class="btn-add btn-sp-br w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('SP-BR')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-SP-BR"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="SP-BMM">
                            <div class="campaign-count-badge hidden" id="count-SP-BMM">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">SP-BMM</h4>
                                <p class="text-sm text-gray-600">Broad Match Modifier</p>
                            </div>
                            <button class="btn-add btn-sp-bmm w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('SP-BMM')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-SP-BMM"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="SP-PAT">
                            <div class="campaign-count-badge hidden" id="count-SP-PAT">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">SP-PAT</h4>
                                <p class="text-sm text-gray-600">Product Targeting</p>
                            </div>
                            <button class="btn-add btn-sp-pat w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('SP-PAT')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-SP-PAT"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="SKC-EX">
                            <div class="campaign-count-badge hidden" id="count-SKC-EX">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">SKC-EX</h4>
                                <p class="text-sm text-gray-600">Single Keyword Campaign</p>
                            </div>
                            <button class="btn-add btn-skc-ex w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('SKC-EX')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-SKC-EX"></div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-medium text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-magic text-purple-600 mr-2"></i>
                        Automatic Campaigns
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="AUTO-CA">
                            <div class="campaign-count-badge hidden" id="count-AUTO-CA">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">AUTO-CA</h4>
                                <p class="text-sm text-gray-600">Catch-All</p>
                            </div>
                            <button class="btn-add btn-auto-ca w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('AUTO-CA')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-AUTO-CA"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="AUTO-CM">
                            <div class="campaign-count-badge hidden" id="count-AUTO-CM">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">AUTO-CM</h4>
                                <p class="text-sm text-gray-600">Close Match</p>
                            </div>
                            <button class="btn-add btn-auto-cm w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('AUTO-CM')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-AUTO-CM"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="AUTO-SB">
                            <div class="campaign-count-badge hidden" id="count-AUTO-SB">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">AUTO-SB</h4>
                                <p class="text-sm text-gray-600">Substitutes</p>
                            </div>
                            <button class="btn-add btn-auto-sb w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('AUTO-SB')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-AUTO-SB"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="AUTO-LM">
                            <div class="campaign-count-badge hidden" id="count-AUTO-LM">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">AUTO-LM</h4>
                                <p class="text-sm text-gray-600">Loose Match</p>
                            </div>
                            <button class="btn-add btn-auto-lm w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('AUTO-LM')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-AUTO-LM"></div>
                        </div>

                        <div class="campaign-card bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 border" data-campaign-type="AUTO-CP">
                            <div class="campaign-count-badge hidden" id="count-AUTO-CP">0</div>
                            <div class="mb-4">
                                <h4 class="font-semibold text-gray-800 text-lg">AUTO-CP</h4>
                                <p class="text-sm text-gray-600">Complements</p>
                            </div>
                            <button class="btn-add btn-auto-cp w-full text-white py-3 px-4 rounded-xl font-medium" 
                                    onclick="addCampaign('AUTO-CP')">
                                <i class="fas fa-plus mr-2"></i> Add Campaign
                            </button>
                            <div class="campaign-instances mt-3" id="instances-AUTO-CP"></div>
                        </div>
                    </div>
                </div>

                <div id="selectedCampaigns" class="mt-8 hidden">
                    <h3 class="text-lg font-medium text-gray-800 mb-4">Selected Campaigns</h3>
                    <div id="campaignChips" class="flex flex-wrap gap-3"></div>
                </div>
            </div>

            <div id="isolationSection" class="isolation-section section-card p-8 mb-8">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-shield-alt text-yellow-600 mr-3 text-3xl"></i>
                    Search Term Isolation
                </h2>
                <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-200 rounded-2xl p-6">
                    <label class="flex items-start cursor-pointer">
                        <input type="checkbox" id="enableIsolation" class="mt-1 mr-4 w-5 h-5 text-blue-600 border-2 border-gray-300 rounded focus:ring-blue-500">
                        <div>
                            <span class="font-semibold text-gray-800 text-lg">Enable Search Term Isolation</span>
                            <p class="text-sm text-gray-600 mt-2 leading-relaxed">
                                When enabled, keywords from SP-EX and SKC-EX campaigns will automatically be added as negative exact keywords to other match type campaigns (SP-PH, SP-BR, SP-BMM, SP-PAT, Auto campaigns) to prevent keyword overlap and improve campaign performance.
                            </p>
                        </div>
                    </label>
                </div>
            </div>

            <div id="configurationSection" class="section-card p-8 mb-8 hidden">
                <h2 class="text-2xl font-semibold mb-6 flex items-center">
                    <i class="fas fa-cog text-gray-600 mr-3 text-3xl"></i>
                    Campaign Configuration
                </h2>
                <div id="campaignTabs" class="border-b border-gray-200 mb-8">
                    <nav class="-mb-px flex space-x-8 overflow-x-auto"></nav>
                </div>
                <div id="tabContent"></div>
            </div>

            <div class="text-center">
                <button id="generateBtn" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-bold py-5 px-12 rounded-2xl text-xl shadow-2xl transform transition hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none" disabled>
                    <i class="fas fa-download mr-3"></i>
                    Generate & Download Campaigns
                </button>
                <p class="text-sm text-gray-500 mt-3">Downloads XLSX file ready for Amazon Seller Central</p>
                
                <div class="mt-6 p-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl border border-green-200">
                    <div class="text-center">
                        <div class="flex items-center justify-center mb-3">
                            <i class="fas fa-upload text-green-600 text-2xl mr-3"></i>
                            <h3 class="text-lg font-semibold text-gray-800">Next Step: Upload Your Campaigns</h3>
                        </div>
                        <p class="text-gray-600 mb-4">Upload your campaigns here</p>
                        <a href="https://advertising.amazon.com/bulksheet/HomePage" 
                           target="_blank" rel="noopener noreferrer"
                           class="inline-flex items-center bg-gradient-to-r from-red-500 via-orange-500 to-yellow-500 hover:from-red-600 hover:via-orange-600 hover:to-yellow-600 text-white font-semibold py-4 px-10 rounded-xl transition-all duration-200 transform hover:scale-105 shadow-lg">
                            <i class="fab fa-amazon mr-3 text-xl"></i>
                            Amazon Seller Central - Bulk Upload
                            <i class="fas fa-external-link-alt ml-3 text-sm"></i>
                        </a>
                        <p class="text-xs text-gray-500 mt-3">
                            <i class="fas fa-info-circle mr-1"></i>
                            Opens Amazon's bulk sheet upload page in a new tab
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bg-gradient-to-r from-gray-800 via-gray-900 to-black text-white py-12 mt-16">
        <div class="container mx-auto px-4 text-center">
            <div class="mb-6">
                <i class="fas fa-code text-blue-400 text-3xl mb-3"></i>
                <p class="text-xl font-medium">Made with ❤️ by Asadullah</p>
                <p class="text-gray-400 mt-2">Amazon PPC Keyword Research & Campaign Builder V2.4</p>
            </div>
            <a href="https://www.linkedin.com/in/muhamadasadullah/" 
               target="_blank" rel="noopener noreferrer"
               class="inline-flex items-center bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold py-3 px-8 rounded-xl transition-all duration-200 transform hover:scale-105">
                <i class="fab fa-linkedin mr-3"></i>
                Connect on LinkedIn
            </a>
        </div>
    </div>

    <script>
        // Global variables - Properly declared at window scope
        window.allKeywords = [];
        window.filteredKeywords = [];
        window.savedKeywords = {
            exact: [],
            broad: [],
            phrase: []
        };
        window.selectedKeywords = new Set();
        window.keywordMatchTypes = new Map();

        // Campaign builder variables
        window.campaigns = [];
        window.campaignConfigs = {};
        window.activeTab = null;

        // Tab switching function - Must be in global scope
        function switchMainTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // File upload handling
        document.addEventListener('DOMContentLoaded', function() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');
            
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('drag-over');
            });
            
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('drag-over');
            });
            
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('drag-over');
                handleFiles(e.dataTransfer.files);
            });
            
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            setupCampaignBuilderEventListeners();
        });

        function handleFiles(files) {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            fileList.classList.remove('hidden');
            
            Array.from(files).forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center justify-between p-3 bg-gray-100 rounded-lg mb-2';
                fileItem.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-file-${file.name.endsWith('.csv') ? 'csv' : 'excel'} text-2xl mr-3 text-blue-600"></i>
                        <div>
                            <p class="font-medium">${file.name}</p>
                            <p class="text-sm text-gray-500">${(file.size / 1024).toFixed(1)} KB</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="text-green-600" id="status-${file.name}">
                            <i class="fas fa-spinner fa-spin"></i> Processing...
                        </span>
                    </div>
                `;
                fileList.appendChild(fileItem);
                
                processFile(file);
            });
        }

        function processFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const data = e.target.result;
                let keywords = [];
                
                try {
                    if (file.name.endsWith('.csv')) {
                        const parsed = Papa.parse(data, { header: true, skipEmptyLines: true });
                        keywords = normalizeData(parsed.data, 'csv');
                    } else {
                        const workbook = XLSX.read(data, { type: 'binary' });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        keywords = normalizeData(jsonData, 'excel');
                    }
                    
                    window.allKeywords = [...window.allKeywords, ...keywords];
                    window.filteredKeywords = [...window.allKeywords];
                    
                    document.getElementById(`status-${file.name}`).innerHTML = 
                        `<i class="fas fa-check text-green-600"></i> ${keywords.length} keywords loaded`;
                    
                    showResults();
                } catch (error) {
                    console.error('Error processing file:', error);
                    document.getElementById(`status-${file.name}`).innerHTML = 
                        `<i class="fas fa-exclamation-triangle text-red-600"></i> Error processing file`;
                }
            };
            
            if (file.name.endsWith('.csv')) {
                reader.readAsText(file);
            } else {
                reader.readAsBinaryString(file);
            }
        }

        function normalizeData(data, format) {
            const columnMap = {
                // Data Dive CSV format
                'Search Terms': 'keyword',
                'SV': 'searchVolume',
                'Relev.': 'relevance',
                
                // H10 Cerebro CSV/Excel format
                'Keyword Phrase': 'keyword',
                'Search Volume': 'searchVolume', 
                'Cerebro IQ Score': 'relevance',
                'Competitor Rank (avg)': 'competitorRank',
                'Ranking Competitors (count)': 'rankingCompetitors',
                'Sponsored Rank (count)': 'sponsoredCount',
                'Title Density': 'titleDensity'
            };
            
            return data.map(row => {
                const normalized = {};
                
                Object.keys(row).forEach(key => {
                    const mappedKey = columnMap[key] || key.toLowerCase().replace(/[^a-z0-9]/g, '');
                    let value = row[key];
                    
                    if (['searchVolume', 'competitorRank', 'rankingCompetitors', 'sponsoredCount', 'titleDensity'].includes(mappedKey)) {
                        value = parseInt(value) || 0;
                    } else if (mappedKey === 'relevance') {
                        value = parseFloat(value) || 0;
                    }
                    
                    normalized[mappedKey] = value;
                });
                
                if (normalized.keyword) {
                    normalized.wordCount = normalized.keyword.trim().split(/\s+/).length;
                }
                
                return normalized;
            }).filter(item => item.keyword && item.keyword.trim());
        }

        function showResults() {
            document.getElementById('filtersSection').classList.remove('hidden');
            document.getElementById('resultsSection').classList.remove('hidden');
            displayResults();
        }

        function applyFilters() {
            const filters = {
                svMin: parseInt(document.getElementById('svMin').value) || 0,
                svMax: parseInt(document.getElementById('svMax').value) || Infinity,
                compRankMax: parseInt(document.getElementById('compRankMax').value) || Infinity,
                rankingCompsMin: parseInt(document.getElementById('rankingCompsMin').value) || 0,
                sponsoredCountMin: parseInt(document.getElementById('sponsoredCountMin').value) || 0,
                titleDensityMax: parseInt(document.getElementById('titleDensityMax').value) || Infinity,
                wordCountMin: parseInt(document.getElementById('wordCountMin').value) || 0,
                wordCountMax: parseInt(document.getElementById('wordCountMax').value) || Infinity,
                includeKeywords: document.getElementById('includeKeywords').value.toLowerCase().split(',').map(s => s.trim()).filter(s => s),
                excludeKeywords: document.getElementById('excludeKeywords').value.toLowerCase().split(',').map(s => s.trim()).filter(s => s)
            };
            
            window.filteredKeywords = window.allKeywords.filter(keyword => {
                const sv = keyword.searchVolume || 0;
                if (sv < filters.svMin || sv > filters.svMax) return false;
                
                const compRank = keyword.competitorRank || 0;
                if (compRank > filters.compRankMax && compRank > 0) return false;
                
                const rankingComps = keyword.rankingCompetitors || 0;
                if (rankingComps < filters.rankingCompsMin) return false;
                
                const sponsoredCount = keyword.sponsoredCount || 0;
                if (sponsoredCount < filters.sponsoredCountMin) return false;
                
                const titleDensity = keyword.titleDensity || 0;
                if (titleDensity > filters.titleDensityMax && titleDensity > 0) return false;
                
                const wordCount = keyword.wordCount || 0;
                if (wordCount < filters.wordCountMin || wordCount > filters.wordCountMax) return false;
                
                if (filters.includeKeywords.length > 0) {
                    const keywordLower = (keyword.keyword || '').toLowerCase();
                    if (!filters.includeKeywords.some(term => keywordLower.includes(term))) {
                        return false;
                    }
                }
                
                if (filters.excludeKeywords.length > 0) {
                    const keywordLower = (keyword.keyword || '').toLowerCase();
                    if (filters.excludeKeywords.some(term => keywordLower.includes(term))) {
                        return false;
                    }
                }
                
                return true;
            });
            
            sortResults();
            displayResults();
        }

        function resetFilters() {
            document.querySelectorAll('#filtersSection input').forEach(input => {
                input.value = '';
            });
            window.filteredKeywords = [...window.allKeywords];
            displayResults();
        }

        function sortResults() {
            const sortBy = document.getElementById('sortBy').value;
            const [field, direction] = sortBy.split('_');
            
            window.filteredKeywords.sort((a, b) => {
                let aVal = a[field] || 0;
                let bVal = b[field] || 0;
                
                if (direction === 'desc') {
                    return bVal - aVal;
                } else {
                    return aVal - bVal;
                }
            });
            
            displayResults();
        }

        function displayResults() {
            const tbody = document.getElementById('resultsTable');
            const noResults = document.getElementById('noResults');
            const resultsCount = document.getElementById('resultsCount');
            
            resultsCount.textContent = `(${window.filteredKeywords.length} keywords)`;
            
            if (window.filteredKeywords.length === 0) {
                tbody.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }
            
            noResults.classList.add('hidden');
            
            tbody.innerHTML = window.filteredKeywords.map((keyword, index) => `
                <tr class="keyword-row border-b hover:bg-gray-50 ${window.selectedKeywords.has(keyword.keyword) ? 'selected' : ''}">
                    <td class="p-3">
                        <input type="checkbox" class="keyword-checkbox" 
                               data-keyword="${keyword.keyword}" 
                               ${window.selectedKeywords.has(keyword.keyword) ? 'checked' : ''}
                               onchange="toggleKeywordSelection('${keyword.keyword}')">
                    </td>
                    <td class="p-3">${keyword.keyword || '—'}</td>
                    <td class="p-3">${(keyword.searchVolume || 0).toLocaleString()}</td>
                    <td class="p-3">${keyword.wordCount || '—'}</td>
                    <td class="p-3">${keyword.competitorRank || '—'}</td>
                    <td class="p-3">${keyword.rankingCompetitors || '—'}</td>
                    <td class="p-3">${keyword.sponsoredCount || '—'}</td>
                    <td class="p-3">${keyword.titleDensity || '—'}</td>
                    <td class="p-3">
                        <select class="border rounded px-2 py-1 text-sm" onchange="handleMatchTypeChange('${keyword.keyword}', this.value)">
                            <option value="">Select</option>
                            <option value="exact" ${window.keywordMatchTypes.get(keyword.keyword) === 'exact' ? 'selected' : ''}>Exact</option>
                            <option value="broad" ${window.keywordMatchTypes.get(keyword.keyword) === 'broad' ? 'selected' : ''}>Broad</option>
                            <option value="phrase" ${window.keywordMatchTypes.get(keyword.keyword) === 'phrase' ? 'selected' : ''}>Phrase</option>
                        </select>
                    </td>
                </tr>
            `).join('');
            
            updateSavedKeywordsDisplay();
            updateBulkToolbar();
        }

        function toggleKeywordSelection(keyword) {
            if (window.selectedKeywords.has(keyword)) {
                window.selectedKeywords.delete(keyword);
            } else {
                window.selectedKeywords.add(keyword);
            }
            updateBulkToolbar();
            displayResults();
        }

        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const keywordCheckboxes = document.querySelectorAll('.keyword-checkbox');
            
            if (selectAllCheckbox.checked) {
                window.filteredKeywords.forEach(keyword => {
                    window.selectedKeywords.add(keyword.keyword);
                });
            } else {
                window.selectedKeywords.clear();
            }
            
            updateBulkToolbar();
            displayResults();
        }

        function updateBulkToolbar() {
            const toolbar = document.getElementById('bulkToolbar');
            const selectedCount = document.getElementById('selectedCount');
            const selectAllCheckbox = document.getElementById('selectAll');
            
            selectedCount.textContent = `${window.selectedKeywords.size} selected`;
            
            if (window.selectedKeywords.size > 0) {
                toolbar.classList.add('show');
            } else {
                toolbar.classList.remove('show');
            }
            
            // Update select all checkbox state
            const totalFiltered = window.filteredKeywords.length;
            const totalSelected = window.selectedKeywords.size;
            
            if (totalSelected === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (totalSelected === totalFiltered) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        function applyBulkMatchType() {
            const matchType = document.getElementById('bulkMatchType').value;
            window.selectedKeywords.forEach(keyword => {
                saveKeyword(keyword, matchType);
            });
            showNotification(`Applied ${matchType} match type to ${window.selectedKeywords.size} keywords`, 'success');
        }

        function clearSelection() {
            window.selectedKeywords.clear();
            updateBulkToolbar();
            displayResults();
        }

        function handleMatchTypeChange(keyword, matchType) {
            if (matchType) {
                window.keywordMatchTypes.set(keyword, matchType);
                saveKeyword(keyword, matchType);
            } else {
                window.keywordMatchTypes.delete(keyword);
            }
        }

        function saveKeyword(keyword, matchType) {
            if (!window.savedKeywords[matchType].includes(keyword)) {
                window.savedKeywords[matchType].push(keyword);
                window.keywordMatchTypes.set(keyword, matchType);
                updateSavedKeywordsDisplay();
                showNotification(`Saved "${keyword}" as ${matchType} match`, 'success');
            }
        }

        function updateSavedKeywordsDisplay() {
            const hasKeywords = Object.values(window.savedKeywords).some(arr => arr.length > 0);
            
            if (hasKeywords) {
                document.getElementById('savedKeywordsSection').classList.remove('hidden');
            }
            
            ['exact', 'broad', 'phrase'].forEach(type => {
                const count = window.savedKeywords[type].length;
                const countElement = document.getElementById(`${type}Count`);
                const keywordsElement = document.getElementById(`${type}Keywords`);
                
                countElement.textContent = count;
                keywordsElement.innerHTML = window.savedKeywords[type].map(keyword => 
                    `<div class="text-xs bg-white rounded px-2 py-1 flex justify-between items-center">
                        <span class="truncate">${keyword}</span>
                        <button onclick="removeSavedKeyword('${keyword}', '${type}')" class="text-red-500 hover:text-red-700 ml-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>`
                ).join('');
            });
        }

        function removeSavedKeyword(keyword, matchType) {
            window.savedKeywords[matchType] = window.savedKeywords[matchType].filter(k => k !== keyword);
            window.keywordMatchTypes.delete(keyword);
            updateSavedKeywordsDisplay();
            displayResults();
        }

        function copyKeywords(matchType) {
            const keywords = window.savedKeywords[matchType].join('\n');
            navigator.clipboard.writeText(keywords).then(() => {
                showNotification(`Copied ${window.savedKeywords[matchType].length} ${matchType} keywords to clipboard`, 'success');
            });
        }

        function exportResults() {
            const csvContent = [
                ['Keyword', 'Search Volume', 'Word Count', 'Competitor Rank', 'Ranking Competitors', 'Sponsored Count', 'Title Density', 'Match Type'].join(','),
                ...window.filteredKeywords.map(k => [
                    `"${k.keyword || ''}"`,
                    k.searchVolume || 0,
                    k.wordCount || 0,
                    k.competitorRank || 0,
                    k.rankingCompetitors || 0,
                    k.sponsoredCount || 0,
                    k.titleDensity || 0,
                    window.keywordMatchTypes.get(k.keyword) || ''
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `filtered_keywords_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Campaign Builder Functions
        function setupCampaignBuilderEventListeners() {
            document.getElementById('enableCustomTheme').addEventListener('change', function() {
                const customThemeInput = document.getElementById('customTheme');
                const campaignThemeSelect = document.getElementById('campaignTheme');
                
                if (this.checked) {
                    customThemeInput.disabled = false;
                    campaignThemeSelect.disabled = true;
                } else {
                    customThemeInput.disabled = true;
                    campaignThemeSelect.disabled = false;
                }
                updateLivePreview();
            });

            document.getElementById('generateBtn').addEventListener('click', generateCampaigns);

            ['productName', 'productASIN', 'productSKUs'].forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    validateForm();
                    updateCampaignOverview();
                    updateLivePreview();
                });
            });

            document.getElementById('campaignTheme').addEventListener('change', function() {
                updateCampaignOverview();
                updateLivePreview();
            });
            
            document.getElementById('customTheme').addEventListener('input', function() {
                updateCampaignOverview();
                updateLivePreview();
            });

            document.getElementById('nomenclaturePattern').addEventListener('input', updateLivePreview);
        }

        function addCampaign(campaignType) {
            const existingInstances = window.campaigns.filter(c => c.type === campaignType);
            const nextVersion = existingInstances.length + 1;
            
            let campaignId;
            if (nextVersion === 1) {
                campaignId = campaignType;
            } else {
                campaignId = `${campaignType}-V${nextVersion}`;
            }
            
            const campaign = {
                id: campaignId,
                type: campaignType,
                version: nextVersion,
                customName: ''
            };
            
            window.campaigns.push(campaign);
            window.campaignConfigs[campaignId] = getDefaultConfig(campaignType);
            
            updateCampaignUI();
        }

        function removeCampaign(campaignId) {
            const index = window.campaigns.findIndex(c => c.id === campaignId);
            if (index > -1) {
                const campaign = window.campaigns[index];
                window.campaigns.splice(index, 1);
                delete window.campaignConfigs[campaignId];
                
                if (window.activeTab === campaignId) {
                    window.activeTab = null;
                }
                
                renumberCampaigns(campaign.type);
                updateCampaignUI();
            }
        }

        function renumberCampaigns(campaignType) {
            const typeCampaigns = window.campaigns.filter(c => c.type === campaignType);
            
            typeCampaigns.forEach((campaign, index) => {
                const newVersion = index + 1;
                let newId;
                
                if (newVersion === 1) {
                    newId = campaignType;
                } else {
                    newId = `${campaignType}-V${newVersion}`;
                }
                
                if (campaign.id !== newId) {
                    window.campaignConfigs[newId] = window.campaignConfigs[campaign.id];
                    delete window.campaignConfigs[campaign.id];
                    
                    if (window.activeTab === campaign.id) {
                        window.activeTab = newId;
                    }
                    
                    campaign.id = newId;
                }
                campaign.version = newVersion;
            });
        }

        function getDefaultConfig(campaignType) {
            const isAuto = campaignType.startsWith('AUTO');
            return {
                budget: 10,
                bid: 0.75,
                keywords: isAuto ? [] : [],
                targetASINs: campaignType === 'SP-PAT' ? [] : undefined,
                biddingStrategy: 'Dynamic bids - down only',
                topOfSearch: 0,
                productPages: 0,
                restOfSearch: 0,
                individualTheme: '',
                customTheme: ''
            };
        }

        function updateCampaignUI() {
            updateCampaignCards();
            updateSelectedCampaigns();
            updateIsolationSection();
            updateConfigurationTabs();
            updateCampaignOverview();
            updateLivePreview();
            validateForm();
        }

        function updateCampaignCards() {
            const campaignTypes = ['SP-EX', 'SP-PH', 'SP-BR', 'SP-BMM', 'SP-PAT', 'SKC-EX', 'AUTO-CA', 'AUTO-CM', 'AUTO-SB', 'AUTO-LM', 'AUTO-CP'];
            
            campaignTypes.forEach(type => {
                const instancesContainer = document.getElementById(`instances-${type}`);
                const countBadge = document.getElementById(`count-${type}`);
                const typeCampaigns = window.campaigns.filter(c => c.type === type);
                
                if (typeCampaigns.length > 0) {
                    countBadge.textContent = typeCampaigns.length;
                    countBadge.classList.remove('hidden');
                } else {
                    countBadge.classList.add('hidden');
                }
                
                if (typeCampaigns.length > 0) {
                    instancesContainer.innerHTML = typeCampaigns.map(campaign => {
                        const displayName = campaign.version === 1 ? campaign.type : `${campaign.type} V${campaign.version}`;
                        return `
                            <div class="campaign-instance-item">
                                <span class="version-label">${displayName}</span>
                                <button onclick="removeCampaign('${campaign.id}')" class="remove-btn">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    }).join('');
                } else {
                    instancesContainer.innerHTML = '';
                }
            });
        }

        function updateSelectedCampaigns() {
            const container = document.getElementById('selectedCampaigns');
            const chipsContainer = document.getElementById('campaignChips');
            
            if (window.campaigns.length === 0) {
                container.classList.add('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            chipsContainer.innerHTML = window.campaigns.map(campaign => {
                const displayName = campaign.version === 1 ? campaign.type : `${campaign.type} V${campaign.version}`;
                return `<div class="bg-gradient-to-r from-blue-100 to-purple-100 text-blue-800 px-4 py-2 rounded-full text-sm flex items-center shadow-md">
                    ${displayName}
                    <button onclick="removeCampaign('${campaign.id}')" class="ml-3 text-blue-600 hover:text-blue-800">
                        <i class="fas fa-times"></i>
                    </button>
                </div>`;
            }).join('');
        }

        function updateIsolationSection() {
            const section = document.getElementById('isolationSection');
            const hasExactCampaigns = window.campaigns.some(campaign => 
                campaign.type === 'SP-EX' || campaign.type === 'SKC-EX'
            );
            
            if (hasExactCampaigns) {
                section.classList.add('show');
            } else {
                section.classList.remove('show');
            }
        }

        function updateConfigurationTabs() {
            const configSection = document.getElementById('configurationSection');
            const tabsNav = document.querySelector('#campaignTabs nav');
            const tabContent = document.getElementById('tabContent');
            
            if (window.campaigns.length === 0) {
                configSection.classList.add('hidden');
                return;
            }
            
            configSection.classList.remove('hidden');
            
            tabsNav.innerHTML = window.campaigns.map(campaign => {
                const displayName = campaign.version === 1 ? campaign.type : `${campaign.type} V${campaign.version}`;
                return `<button class="tab-button py-3 px-6 border-b-2 font-medium text-sm transition-all duration-200 ${window.activeTab === campaign.id ? 'border-blue-500 text-blue-600 bg-blue-50' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'}" 
                         onclick="switchTab('${campaign.id}')">${displayName}</button>`;
            }).join('');
            
            if (!window.activeTab && window.campaigns.length > 0) {
                window.activeTab = window.campaigns[0].id;
            }
            
            if (window.activeTab && window.campaigns.find(c => c.id === window.activeTab)) {
                const campaign = window.campaigns.find(c => c.id === window.activeTab);
                tabContent.innerHTML = generateTabContent(campaign);
                setupCampaignEventHandlers(campaign.id);
                loadTabData(campaign.id);
            }
        }

        function switchTab(campaignId) {
            if (window.activeTab) {
                saveCurrentTabData(window.activeTab);
            }
            
            window.activeTab = campaignId;
            updateConfigurationTabs();
            updateLivePreview();
        }

        function updateCampaignOverview() {
            const overviewSection = document.getElementById('campaignOverview');
            const productName = document.getElementById('productName').value.trim();
            const productASIN = document.getElementById('productASIN').value.trim();
            const productSKUs = document.getElementById('productSKUs').value.trim();
            
            if (!productName && !productASIN && window.campaigns.length === 0) {
                overviewSection.classList.add('hidden');
                return;
            }
            
            overviewSection.classList.remove('hidden');
            
            const totalCampaigns = window.campaigns.length;
            let totalKeywords = 0;
            let totalTargets = 0;
            let totalBudget = 0;
            
            window.campaigns.forEach(campaign => {
                const config = window.campaignConfigs[campaign.id];
                if (config) {
                    if (config.keywords && Array.isArray(config.keywords)) {
                        const actualKeywords = config.keywords.filter(keyword => 
                            keyword && keyword.trim() !== '' && keyword.trim() !== '+'
                        );
                        totalKeywords += actualKeywords.length;
                    }
                    
                    if (campaign.type === 'SP-PAT' && config.targetASINs && Array.isArray(config.targetASINs)) {
                        const actualTargets = config.targetASINs.filter(asin => 
                            asin && asin.trim() !== ''
                        );
                        totalTargets += actualTargets.length;
                    }
                    
                    totalBudget += config.budget || 0;
                }
            });
            
            document.getElementById('totalCampaigns').textContent = totalCampaigns;
            document.getElementById('totalKeywords').textContent = totalKeywords;
            document.getElementById('totalTargets').textContent = totalTargets;
            document.getElementById('totalBudget').textContent = `$${totalBudget}`;
            
            const skuCount = productSKUs ? productSKUs.split('\n').filter(s => s.trim()).length : 0;
            document.getElementById('overviewProductInfo').innerHTML = `
                <div class="flex justify-between"><span>Product:</span><span>${productName || 'Not set'}</span></div>
                <div class="flex justify-between"><span>ASIN:</span><span>${productASIN || 'Not set'}</span></div>
                <div class="flex justify-between"><span>SKUs:</span><span>${skuCount} SKU${skuCount !== 1 ? 's' : ''}</span></div>
            `;
            
            const manualCount = window.campaigns.filter(c => !c.type.startsWith('AUTO')).length;
            const autoCount = window.campaigns.filter(c => c.type.startsWith('AUTO')).length;
            const avgBudget = totalCampaigns > 0 ? (totalBudget / totalCampaigns) : 0;
            
            document.getElementById('overviewCampaignInfo').innerHTML = `
                <div class="flex justify-between"><span>Campaign Types:</span><span>${manualCount} Manual, ${autoCount} Auto</span></div>
                <div class="flex justify-between"><span>Avg Budget/Campaign:</span><span>$${avgBudget.toFixed(2)}</span></div>
            `;
        }

        function updateLivePreview() {
            const previewContent = document.getElementById('livePreviewContent');
            const productName = document.getElementById('productName').value.trim();
            const productASIN = document.getElementById('productASIN').value.trim();
            
            if (!productName && !productASIN && !window.activeTab) {
                previewContent.innerHTML = 'Enter product details and configure a campaign to see preview';
                previewContent.className = 'preview-campaign-name preview-empty-state';
                return;
            }
            
            if (!window.activeTab && window.campaigns.length === 0) {
                previewContent.innerHTML = 'Select and configure a campaign to see preview';
                previewContent.className = 'preview-campaign-name preview-empty-state';
                return;
            }
            
            let targetCampaign = null;
            if (window.activeTab && window.campaigns.find(c => c.id === window.activeTab)) {
                targetCampaign = window.campaigns.find(c => c.id === window.activeTab);
            } else if (window.campaigns.length > 0) {
                targetCampaign = window.campaigns[0];
            }
            
            if (targetCampaign) {
                const pattern = document.getElementById('nomenclaturePattern').value;
                const previewName = generatePreviewName(targetCampaign, pattern, productName, productASIN);
                previewContent.textContent = previewName;
                previewContent.className = 'preview-campaign-name';
            } else {
                previewContent.innerHTML = 'Configure campaign settings to see preview';
                previewContent.className = 'preview-campaign-name preview-empty-state';
            }
        }

        function generatePreviewName(campaign, pattern, productName, productASIN) {
            if (campaign.customName && campaign.customName.trim()) {
                return campaign.customName.trim();
            }
            
            const config = window.campaignConfigs[campaign.id];
            let theme = '';
            
            if (config && config.customTheme) {
                theme = config.customTheme;
            } else if (config && config.individualTheme) {
                theme = config.individualTheme;
            } else {
                const enableCustomTheme = document.getElementById('enableCustomTheme').checked;
                if (enableCustomTheme) {
                    theme = document.getElementById('customTheme').value.trim();
                } else {
                    theme = document.getElementById('campaignTheme').value;
                }
            }
            
            const codes = [];
            if (config) {
                if (config.topOfSearch > 0) codes.push('TOS');
                if (config.productPages > 0) codes.push('PP');
                if (config.restOfSearch > 0) codes.push('ROS');
            }
            const placementCodes = codes.join('-');
            
            const parts = [];
            if (productName) parts.push(productName);
            if (theme) parts.push(theme);
            parts.push(campaign.id);
            if (productASIN) parts.push(productASIN);
            if (placementCodes) parts.push(placementCodes);
            
            return parts.join(' - ');
        }

        function validateForm() {
            const productName = document.getElementById('productName').value.trim();
            const productASIN = document.getElementById('productASIN').value.trim();
            const productSKUs = document.getElementById('productSKUs').value.trim();
            const hasValidCampaigns = window.campaigns.length > 0;
            
            const isValid = productName && productASIN && productSKUs && hasValidCampaigns;
            document.getElementById('generateBtn').disabled = !isValid;
        }

        function generateTabContent(campaign) {
            const config = window.campaignConfigs[campaign.id];
            const isAuto = campaign.type.startsWith('AUTO');
            const isProductTargeting = campaign.type === 'SP-PAT';
            
            return `
                <div class="space-y-8">
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-2xl border border-blue-200">
                        <label class="block text-sm font-medium text-gray-700 mb-3">
                            <i class="fas fa-edit mr-2 text-blue-600"></i>
                            Custom Campaign Name (Optional)
                        </label>
                        <input type="text" data-campaign="${campaign.id}" data-field="customName"
                               placeholder="Leave empty to use automatic naming pattern"
                               class="form-input w-full focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-2">Override the automatic naming for this specific campaign</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Daily Budget ($)</label>
                            <input type="number" value="${config.budget}" step="0.01" min="1"
                                   data-campaign="${campaign.id}" data-field="budget"
                                   class="form-input w-full focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Starting Bid ($)</label>
                            <input type="number" value="${config.bid}" step="0.01" min="0.02"
                                   data-campaign="${campaign.id}" data-field="bid"
                                   class="form-input w-full focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Bidding Strategy</label>
                            <select data-campaign="${campaign.id}" data-field="biddingStrategy"
                                    class="form-input w-full focus:ring-2 focus:ring-blue-500">
                                <option value="Dynamic bids - down only" ${config.biddingStrategy === 'Dynamic bids - down only' ? 'selected' : ''}>Dynamic bids - down only</option>
                                <option value="Dynamic bids - up and down" ${config.biddingStrategy === 'Dynamic bids - up and down' ? 'selected' : ''}>Dynamic bids - up and down</option>
                                <option value="Fixed bids" ${config.biddingStrategy === 'Fixed bids' ? 'selected' : ''}>Fixed bids</option>
                            </select>
                        </div>
                    </div>
                    
                    ${!isAuto && !isProductTargeting ? `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Keywords (one per line)</label>
                        <textarea rows="6" placeholder="Enter keywords, one per line&#10;wireless earbuds&#10;bluetooth headphones&#10;noise cancelling headphones"
                                  data-campaign="${campaign.id}" data-field="keywords"
                                  class="form-input w-full focus:ring-2 focus:ring-blue-500">${config.keywords.join('\n')}</textarea>
                        <div class="mt-2 flex flex-wrap gap-2">
                            <button onclick="populateFromSaved('${campaign.id}', 'exact')" class="text-xs bg-gradient-to-r from-blue-600 to-blue-700 text-white px-3 py-1 rounded hover:from-blue-700 hover:to-blue-800 transition-colors">
                                Import Exact Keywords (${window.savedKeywords.exact.length})
                            </button>
                            <button onclick="populateFromSaved('${campaign.id}', 'broad')" class="text-xs bg-gradient-to-r from-green-600 to-green-700 text-white px-3 py-1 rounded hover:from-green-700 hover:to-green-800 transition-colors">
                                Import Broad Keywords (${window.savedKeywords.broad.length})
                            </button>
                            <button onclick="populateFromSaved('${campaign.id}', 'phrase')" class="text-xs bg-gradient-to-r from-purple-600 to-purple-700 text-white px-3 py-1 rounded hover:from-purple-700 hover:to-purple-800 transition-colors">
                                Import Phrase Keywords (${window.savedKeywords.phrase.length})
                            </button>
                        </div>
                    </div>
                    ` : ''}
                    
                    ${isProductTargeting ? `
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Target ASINs (one per line)</label>
                        <textarea rows="4" placeholder="B08XYZ123ABC&#10;B07ABC456DEF"
                                  data-campaign="${campaign.id}" data-field="targetASINs"
                                  class="form-input w-full focus:ring-2 focus:ring-blue-500">${(config.targetASINs || []).join('\n')}</textarea>
                    </div>
                    ` : ''}
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-4">Placement Modifiers (%)</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Top of Search</label>
                                <input type="number" value="${config.topOfSearch}" min="0" max="900"
                                       data-campaign="${campaign.id}" data-field="topOfSearch"
                                       class="form-input w-full focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Product Pages</label>
                                <input type="number" value="${config.productPages}" min="0" max="900"
                                       data-campaign="${campaign.id}" data-field="productPages"
                                       class="form-input w-full focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">Rest of Search</label>
                                <input type="number" value="${config.restOfSearch}" min="0" max="900"
                                       data-campaign="${campaign.id}" data-field="restOfSearch"
                                       class="form-input w-full focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function populateFromSaved(campaignId, matchType) {
            const textarea = document.querySelector(`[data-campaign="${campaignId}"][data-field="keywords"]`);
            if (textarea && window.savedKeywords[matchType].length > 0) {
                const currentKeywords = textarea.value.split('\n').filter(k => k.trim());
                const newKeywords = window.savedKeywords[matchType].filter(k => !currentKeywords.includes(k));
                
                if (newKeywords.length > 0) {
                    const allKeywords = [...currentKeywords, ...newKeywords];
                    textarea.value = allKeywords.join('\n');
                    saveCurrentTabData(campaignId);
                    showNotification(`Added ${newKeywords.length} ${matchType} keywords to campaign`, 'success');
                } else {
                    showNotification(`All ${matchType} keywords are already in this campaign`, 'info');
                }
            }
        }

        function setupCampaignEventHandlers(campaignId) {
            const fields = document.querySelectorAll(`[data-campaign="${campaignId}"]`);
            
            fields.forEach(field => {
                const eventType = field.tagName === 'SELECT' ? 'change' : 
                                field.tagName === 'TEXTAREA' ? 'blur' : 'input';
                
                field.addEventListener(eventType, function() {
                    saveCurrentTabData(campaignId);
                    updateCampaignOverview();
                    updateLivePreview();
                });
            });
        }

        function saveCurrentTabData(campaignId) {
            if (!window.campaignConfigs[campaignId]) return;
            
            const budgetField = document.querySelector(`[data-campaign="${campaignId}"][data-field="budget"]`);
            const bidField = document.querySelector(`[data-campaign="${campaignId}"][data-field="bid"]`);
            const keywordsField = document.querySelector(`[data-campaign="${campaignId}"][data-field="keywords"]`);
            const targetASINsField = document.querySelector(`[data-campaign="${campaignId}"][data-field="targetASINs"]`);
            const biddingStrategyField = document.querySelector(`[data-campaign="${campaignId}"][data-field="biddingStrategy"]`);
            const topOfSearchField = document.querySelector(`[data-campaign="${campaignId}"][data-field="topOfSearch"]`);
            const productPagesField = document.querySelector(`[data-campaign="${campaignId}"][data-field="productPages"]`);
            const restOfSearchField = document.querySelector(`[data-campaign="${campaignId}"][data-field="restOfSearch"]`);
            const customNameField = document.querySelector(`[data-campaign="${campaignId}"][data-field="customName"]`);
            
            if (budgetField) window.campaignConfigs[campaignId].budget = parseFloat(budgetField.value) || 10;
            if (bidField) window.campaignConfigs[campaignId].bid = parseFloat(bidField.value) || 0.75;
            if (keywordsField) {
                let keywords = keywordsField.value.split('\n')
                    .map(k => k.trim())
                    .filter(k => k !== '' && k !== '+');
                
                // Add + prefix for SP-BMM campaigns
                const campaign = window.campaigns.find(c => c.id === campaignId);
                if (campaign && campaign.type === 'SP-BMM') {
                    keywords = keywords.map(k => k.startsWith('+') ? k : `+${k}`);
                }
                
                window.campaignConfigs[campaignId].keywords = keywords;
            }
            if (targetASINsField) {
                const targetASINs = targetASINsField.value.split('\n').map(a => a.trim()).filter(a => a);
                window.campaignConfigs[campaignId].targetASINs = targetASINs;
            }
            if (biddingStrategyField) window.campaignConfigs[campaignId].biddingStrategy = biddingStrategyField.value;
            if (topOfSearchField) window.campaignConfigs[campaignId].topOfSearch = parseInt(topOfSearchField.value) || 0;
            if (productPagesField) window.campaignConfigs[campaignId].productPages = parseInt(productPagesField.value) || 0;
            if (restOfSearchField) window.campaignConfigs[campaignId].restOfSearch = parseInt(restOfSearchField.value) || 0;
            if (customNameField) {
                const campaign = window.campaigns.find(c => c.id === campaignId);
                if (campaign) {
                    campaign.customName = customNameField.value;
                }
            }
            
            updateLivePreview();
            updateCampaignOverview();
        }

        function loadTabData(campaignId) {
            const config = window.campaignConfigs[campaignId];
            if (!config) return;
            
            setTimeout(() => {
                const budgetField = document.querySelector(`[data-campaign="${campaignId}"][data-field="budget"]`);
                const bidField = document.querySelector(`[data-campaign="${campaignId}"][data-field="bid"]`);
                const keywordsField = document.querySelector(`[data-campaign="${campaignId}"][data-field="keywords"]`);
                const targetASINsField = document.querySelector(`[data-campaign="${campaignId}"][data-field="targetASINs"]`);
                const biddingStrategyField = document.querySelector(`[data-campaign="${campaignId}"][data-field="biddingStrategy"]`);
                const topOfSearchField = document.querySelector(`[data-campaign="${campaignId}"][data-field="topOfSearch"]`);
                const productPagesField = document.querySelector(`[data-campaign="${campaignId}"][data-field="productPages"]`);
                const restOfSearchField = document.querySelector(`[data-campaign="${campaignId}"][data-field="restOfSearch"]`);
                const customNameField = document.querySelector(`[data-campaign="${campaignId}"][data-field="customName"]`);
                
                if (budgetField) budgetField.value = config.budget;
                if (bidField) bidField.value = config.bid;
                if (keywordsField) keywordsField.value = config.keywords.join('\n');
                if (targetASINsField) targetASINsField.value = (config.targetASINs || []).join('\n');
                if (biddingStrategyField) biddingStrategyField.value = config.biddingStrategy;
                if (topOfSearchField) topOfSearchField.value = config.topOfSearch;
                if (productPagesField) productPagesField.value = config.productPages;
                if (restOfSearchField) restOfSearchField.value = config.restOfSearch;
                if (customNameField) {
                    const campaign = window.campaigns.find(c => c.id === campaignId);
                    if (campaign) {
                        customNameField.value = campaign.customName || '';
                    }
                }
                
                updateCampaignOverview();
                updateLivePreview();
            }, 50);
        }

        function generateCampaigns() {
            const productName = document.getElementById('productName').value.trim();
            const productASIN = document.getElementById('productASIN').value.trim();
            const productSKUs = document.getElementById('productSKUs').value.trim().split('\n').filter(sku => sku.trim());
            
            const isolationEnabled = document.getElementById('enableIsolation').checked;
            
            let exactKeywords = [];
            if (isolationEnabled) {
                window.campaigns.forEach(campaign => {
                    if ((campaign.type === 'SP-EX' || campaign.type === 'SKC-EX') && window.campaignConfigs[campaign.id]) {
                        const config = window.campaignConfigs[campaign.id];
                        if (config.keywords) {
                            const actualKeywords = config.keywords.filter(k => k && k.trim() !== '' && k.trim() !== '+');
                            exactKeywords = exactKeywords.concat(actualKeywords);
                        }
                    }
                });
            }
            
            const worksheetData = [];
            
            worksheetData.push([
                'Product', 'Entity', 'Operation', 'Campaign ID', 'Ad Group ID', 'Portfolio ID', 'Ad ID', 'Keyword ID',
                'Product Targeting ID', 'Campaign Name', 'Ad Group Name', 'Start Date', 'End Date', 'Targeting Type',
                'State', 'Daily Budget', 'SKU', 'ASIN', 'Ad Group Default Bid', 'Bid', 'Keyword Text', 'Match Type',
                'Bidding Strategy', 'Placement', 'Percentage', 'Product Targeting Expression'
            ]);
            
            window.campaigns.forEach((campaign, campaignIndex) => {
                const config = window.campaignConfigs[campaign.id];
                const placements = {
                    topOfSearch: config.topOfSearch || 0,
                    productPages: config.productPages || 0,
                    restOfSearch: config.restOfSearch || 0
                };
                
                const campaignName = generateCampaignName(campaign, placements);
                const displayName = campaign.version === 1 ? campaign.type : `${campaign.type} V${campaign.version}`;
                const adGroupName = `${displayName} - ${campaign.type.includes('AUTO') ? 'Auto' : 'Manual'}`;
                const isAuto = campaign.type.startsWith('AUTO');
                const targetingType = isAuto ? 'auto' : 'manual';
                
                worksheetData.push([
                    'Sponsored Products', 'Campaign', 'Create', campaignName, '', '', '', '', '', campaignName, '',
                    new Date().toISOString().slice(0, 10).replace(/-/g, ''), '', targetingType, 'enabled',
                    config.budget, '', '', '', '', '', '', config.biddingStrategy, '', '', ''
                ]);
                
                if (placements.topOfSearch > 0) {
                    worksheetData.push([
                        'Sponsored Products', 'Bidding adjustment', 'Create', campaignName, '', '', '', '', '', '', '',
                        '', '', '', '', '', '', '', '', '', '', '', '', 'placement top', placements.topOfSearch, ''
                    ]);
                }
                if (placements.productPages > 0) {
                    worksheetData.push([
                        'Sponsored Products', 'Bidding adjustment', 'Create', campaignName, '', '', '', '', '', '', '',
                        '', '', '', '', '', '', '', '', '', '', '', '', 'placement product page', placements.productPages, ''
                    ]);
                }
                if (placements.restOfSearch > 0) {
                    worksheetData.push([
                        'Sponsored Products', 'Bidding adjustment', 'Create', campaignName, '', '', '', '', '', '', '',
                        '', '', '', '', '', '', '', '', '', '', '', '', 'placement rest of search', placements.restOfSearch, ''
                    ]);
                }
                
                worksheetData.push([
                    'Sponsored Products', 'Ad group', 'Create', campaignName, adGroupName, '', '', '', '', '', adGroupName,
                    '', '', '', 'enabled', '', '', '', config.bid, '', '', '', '', '', '', ''
                ]);
                
                productSKUs.forEach(sku => {
                    worksheetData.push([
                        'Sponsored Products', 'Product ad', 'Create', campaignName, adGroupName, '', '', '', '', '', '',
                        '', '', '', 'enabled', '', sku.trim(), '', '', '', '', '', '', '', '', ''
                    ]);
                });
                
                if (!isAuto && campaign.type !== 'SP-PAT') {
                    const actualKeywords = config.keywords.filter(k => k && k.trim() !== '' && k.trim() !== '+');
                    actualKeywords.forEach(keyword => {
                        let matchType = 'exact';
                        let keywordText = keyword.trim();
                        
                        if (campaign.type === 'SP-PH') matchType = 'phrase';
                        else if (campaign.type === 'SP-BR' || campaign.type === 'SP-BMM') {
                            matchType = 'broad';
                            if (campaign.type === 'SP-BMM' && !keywordText.startsWith('+')) {
                                keywordText = `+${keywordText}`;
                            }
                        }
                        
                        worksheetData.push([
                            'Sponsored Products', 'Keyword', 'Create', campaignName, adGroupName, '', '', '', '', '', '',
                            '', '', '', 'enabled', '', '', '', '', config.bid, keywordText, matchType, '', '', '', ''
                        ]);
                    });
                    
                    if (isolationEnabled && !['SP-EX', 'SKC-EX'].includes(campaign.type)) {
                        exactKeywords.forEach(keyword => {
                            if (keyword.trim()) {
                                worksheetData.push([
                                    'Sponsored Products', 'Negative keyword', 'Create', campaignName, adGroupName, '', '', '', '', '', '',
                                    '', '', '', 'enabled', '', '', '', '', '', keyword.trim(), 'negativeExact', '', '', '', ''
                                ]);
                            }
                        });
                    }
                } else if (campaign.type === 'SP-PAT') {
                    const actualTargets = (config.targetASINs || []).filter(a => a && a.trim() !== '');
                    actualTargets.forEach(asin => {
                        worksheetData.push([
                            'Sponsored Products', 'Product targeting', 'Create', campaignName, adGroupName, '', '', '', '', '', '',
                            '', '', '', 'enabled', '', '', '', '', config.bid, '', '', '', '', '', `asin="${asin.trim()}"`
                        ]);
                    });
                    
                    if (isolationEnabled) {
                        exactKeywords.forEach(keyword => {
                            if (keyword.trim()) {
                                worksheetData.push([
                                    'Sponsored Products', 'Negative keyword', 'Create', campaignName, adGroupName, '', '', '', '', '', '',
                                    '', '', '', 'enabled', '', '', '', '', '', keyword.trim(), 'negativeExact', '', '', '', ''
                                ]);
                            }
                        });
                    }
                } else if (isAuto) {
                    if (campaign.type === 'AUTO-CA') {
                        const allTargetingTypes = ['close-match', 'loose-match', 'substitutes', 'complements'];
                        
                        allTargetingTypes.forEach(targetingType => {
                            worksheetData.push([
                                'Sponsored Products', 'Product targeting', 'Create', campaignName, adGroupName, '', '', '', '', '', '',
                                '', '', '', 'enabled', '', '', '', '', config.bid, '', '', '', '', '', targetingType
                            ]);
                        });
                    } else {
                        let targetingExpression = '';
                        switch (campaign.type) {
                            case 'AUTO-CM': targetingExpression = 'close-match'; break;
                            case 'AUTO-SB': targetingExpression = 'substitutes'; break;
                            case 'AUTO-LM': targetingExpression = 'loose-match'; break;
                            case 'AUTO-CP': targetingExpression = 'complements'; break;
                        }
                        
                        worksheetData.push([
                            'Sponsored Products', 'Product targeting', 'Create', campaignName, adGroupName, '', '', '', '', '', '',
                            '', '', '', 'enabled', '', '', '', '', config.bid, '', '', '', '', '', targetingExpression
                        ]);
                    }
                    
                    if (isolationEnabled) {
                        exactKeywords.forEach(keyword => {
                            if (keyword.trim()) {
                                worksheetData.push([
                                    'Sponsored Products', 'Negative keyword', 'Create', campaignName, adGroupName, '', '', '', '', '', '',
                                    '', '', '', 'enabled', '', '', '', '', '', keyword.trim(), 'negativeExact', '', '', '', ''
                                ]);
                            }
                        });
                    }
                }
                
                // Add blank rows between campaigns for proper spacing
                if (campaignIndex < window.campaigns.length - 1) {
                    worksheetData.push(['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']);
                    worksheetData.push(['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']);
                }
            });
            
            const ws = XLSX.utils.aoa_to_sheet(worksheetData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Amazon PPC Campaigns');
            
            const filename = `Amazon_PPC_Campaigns_${productName.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().slice(0, 10)}.xlsx`;
            XLSX.writeFile(wb, filename);
        }

        function generateCampaignName(campaign, placements) {
            return generatePreviewName(campaign, document.getElementById('nomenclaturePattern').value, 
                                     document.getElementById('productName').value.trim(), 
                                     document.getElementById('productASIN').value.trim());
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transition-all transform translate-x-full`;
            notification.className += type === 'success' ? ' bg-green-500 text-white' : ' bg-blue-500 text-white';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Added by agent: match-type auto-sync and remove-all functionality
        function setMatchType(keyword, matchType) {
            ['exact','broad','phrase'].forEach(t => {
                window.savedKeywords[t] = (window.savedKeywords[t] || []).filter(k => k !== keyword);
            });
            if (matchType) {
                if (!window.savedKeywords[matchType].includes(keyword)) {
                    window.savedKeywords[matchType].push(keyword);
                }
                window.keywordMatchTypes.set(keyword, matchType);
            } else {
                window.keywordMatchTypes.delete(keyword);
            }
            updateSavedKeywordsDisplay();
            displayResults();
        }

        // Added by agent: duplicate keyword across match types without removal
        function addMatchType(keyword, matchType) {
            // ensure the bucket exists
            if (!Array.isArray(window.savedKeywords[matchType])) {
                window.savedKeywords[matchType] = [];
            }
            // only push if not already present
            if (!window.savedKeywords[matchType].includes(keyword)) {
                window.savedKeywords[matchType].push(keyword);
            }
            // Update the keywordMatchTypes map so the dropdown shows the newly added type
            if (matchType) {
                window.keywordMatchTypes.set(keyword, matchType);
            }
            updateSavedKeywordsDisplay();
            displayResults();
        }

        // Added by agent: exclusive move of a keyword to a single match type
        function moveMatchType(keyword, matchType) {
            // Remove from all lists first
            ['exact','broad','phrase'].forEach(t => {
                window.savedKeywords[t] = (window.savedKeywords[t] || []).filter(k => k !== keyword);
            });
            if (matchType) {
                if (!window.savedKeywords[matchType].includes(keyword)) {
                    window.savedKeywords[matchType].push(keyword);
                }
                window.keywordMatchTypes.set(keyword, matchType);
            } else {
                window.keywordMatchTypes.delete(keyword);
            }
            updateSavedKeywordsDisplay();
            displayResults();
        }
        function handleMatchTypeChange(keyword, matchType) {
            // Always move when user selects match type from the dropdown (exclusive)
            moveMatchType(keyword, matchType);
            showNotification(`Set \"${keyword}\" to ${matchType || 'None'}`, 'success');
        }
        function saveKeyword(keyword, matchType) {
            // Save always moves keyword to the chosen match type
            moveMatchType(keyword, matchType);
            showNotification(`Saved \"${keyword}\" as ${matchType} match`, 'success');
        }
        function applyBulkMatchType() {
            const matchType = document.getElementById('bulkMatchType').value;
            const addMode = document.getElementById('bulkAddMode') && document.getElementById('bulkAddMode').checked;
            // No match type selected or no keywords selected
            if (!matchType || !window.selectedKeywords || window.selectedKeywords.size === 0) {
                showNotification('Please select a match type and at least one keyword.', 'warning');
                return;
            }
            window.selectedKeywords.forEach(keyword => {
                if (addMode) {
                    addMatchType(keyword, matchType);
                } else {
                    moveMatchType(keyword, matchType);
                }
            });
            showNotification(`${addMode ? 'Added' : 'Moved'} ${window.selectedKeywords.size} keyword(s) to ${matchType}`, 'success');
        }
        function clearKeywords(matchType) {
            const removed = window.savedKeywords[matchType] || [];
            removed.forEach(k => window.keywordMatchTypes.delete(k));
            window.savedKeywords[matchType] = [];
            updateSavedKeywordsDisplay();
            displayResults();
            showNotification(`Removed ${removed.length} ${matchType} keywords`, 'success');
        }
        function clearAllKeywords() {
            ['exact','broad','phrase'].forEach(t => {
                (window.savedKeywords[t] || []).forEach(k => window.keywordMatchTypes.delete(k));
                window.savedKeywords[t] = [];
            });
            updateSavedKeywordsDisplay();
            displayResults();
            showNotification('Removed all saved keywords', 'success');
        }
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9765c64f7dc8167a","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.8.0","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDoYvJsRy5Ol2Xot4wzSNcCfgI%2BLWLY53Tjn0xzhIwrTQYpA%2FYTn9wKGWy6uUwOnOxGX5XaAu%2FeAmj95mRVVABxE3%2Fdv2UlLfEwYJUuNZQ%2FHV3BafFGNmbKJ84TJ0oWjUkGqGA2I6GvbtnDFPxaYsLD9lvkkV6rRn1WYZ3WUx4Ysapq%2BHLvIZqGlGKJEtBZAaMzu9ynvTlf2SkylAnpvOcGjc4KNX0Ig04rh7k2vsnNSRTxASNaoPtcGfSzt1t3WLuq%2BN0%2FD7UJ4pC%2BSOGBpZU4Art2HSMv%2FKehTjTX%2FlUJk1sVhrq1EcTQoM%2BsZVtbFt%2FpjMK9UpSjdnw6aXvehFNAemlqR6xJCNRHzL4My326I%2BI0agMYbU%2Fl2ODKrn9bEJ%2BMipf%2F69V%2B92ZYEUNmCxYQRqixtkIwWGm3Jjcl%2BtLW4BCO9mimZjZNGT0jtYQ6H3iabWQTW%2FxK6wFRlgdSFwlkBX9ZnxImuh3hPzniklQXSmHZkjGLlPjb86doeeyXGcgvqJX214uX0%2B%2FBXVakkJw4k%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDoYvJsRy5Ol2Xot4wzSNcCfgI+LWLY53Tjn0xzhIwrTQYpA/YTn9wKGWy6uUwOnOxGX5XaAu/eAmj95mRVVABxE3/dv2UlLfEwYJUuNZQ/HV3BafFGNmbKJ84TJ0oWjUkGqGA2I6GvbtnDFPxaYsLD9lvkkV6rRn1WYZ3WUx4Ysapq+HLvIZqGlGKJEtBZAaMzu9ynvTlf2SkylAnpvOcGjc4KNX0Ig04rh7k2vsnNSRTxASNaoPtcGfSzt1t3WLuq+N0/D7UJ4pC+SOGBpZU4Art2HSMv/KehTjTX/lUJk1sVhrq1EcTQoM+sZVtbFt/pjMK9UpSjdnw6aXvehFNAemlqR6xJCNRHzL4My326I+I0agMYbU/l2ODKrn9bEJ+Mipf/69V+92ZYEUNmCxYQRqixtkIwWGm3Jjcl+tLW4BCO9mimZjZNGT0jtYQ6H3iabWQTW/xK6wFRlgdSFwlkBX9ZnxImuh3hPzniklQXSmHZkjGLlPjb86doeeyXGcgvqJX214uX0+/BXVakkJw4k=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    